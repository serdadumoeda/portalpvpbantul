stages:
  - deploy

deploy_production:
  stage: deploy
  tags:
    - centos-deploy 
  only:
    - main
  script:
    - echo "Memulai Deployment Lokal..."
    
    
    - cd /var/www/portalpvpbantul
    
    
    - sudo chown -R gitlab-runner:nginx .
    - git config --global --add safe.directory /var/www/portalpvpbantul
    - git fetch origin main
    - git reset --hard origin/main
    
    
    - composer install --no-dev --optimize-autoloader --no-interaction
    
    
    - php artisan migrate --force
    - php artisan optimize:clear
    - php artisan config:cache
    - php artisan route:cache
    - php artisan view:cache
    
    
    - sudo chown -R nginx:nginx .
    - sudo chmod -R 775 storage bootstrap/cache
    - sudo systemctl reload php-fpm
    - sudo systemctl reload nginx
    
    - echo "Deployment Sukses! ðŸš€"